#!/bin/bash

QUICKSHELL_PATH="$HOME/.config/quickshell/shell.qml"
STATE_FILE="$HOME/.cache/.nekoroshell_active"

notify_user() {
    makenotif customize preferences-desktop-theme "Desktop Environment" "$1" true
}

if pgrep -x "quickshell" > /dev/null; then
    echo "Switching to Legacy Mode..."
    pkill -x quickshell
    rm "$STATE_FILE"
    systemctl --user start --now waybar.service &
    notify_user "Switched to Legacy (Waybar)"
else
    echo "Switching to NeKoRoSHELL..."
    pkill -x waybar
    systemctl --user stop waybar.service
    touch "$STATE_FILE"
    quickshell --path "$QUICKSHELL_PATH" &
    notify_user "Switched to NeKoRoSHELL"
fi
