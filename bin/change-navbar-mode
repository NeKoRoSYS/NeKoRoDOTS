#!/bin/bash

MODE_FILE="$HOME/.cache/.waybar_mode"
CURRENT_MODE=$(cat "$MODE_FILE" 2>/dev/null || echo "static")

STATIC="Static (Always Visible)"
DYNAMIC="Dynamic (Smart Auto-hide)"
HOVER="Hover (Mouse Reveal)"

CHOICE=$(echo -e "$STATIC\n$DYNAMIC\n$HOVER" | wofi --dmenu --prompt "Select Navbar Mode" --lines 3 --width 400)

if [ -z "$CHOICE" ]; then
    exit 0
fi

stop_services() {
    systemctl --user stop waybar.service
    systemctl --user stop navbar-watcher.service
    systemctl --user stop navbar-hover.service
    killall waybar 2>/dev/null
}

case "$CHOICE" in
    "$STATIC")
        if [ "$CURRENT_MODE" != "static" ]; then
            stop_services
            systemctl --user start waybar.service
            echo "static" > "$MODE_FILE"
            makenotif customize preferences-system "Navbar" "Persistent mode enabled." true
        fi
        ;;
        
    "$DYNAMIC")
        if [ "$CURRENT_MODE" != "dynamic" ]; then
            stop_services
            systemctl --user start navbar-watcher.service
            echo "dynamic" > "$MODE_FILE"
            makenotif customize preferences-system "Navbar" "Smart Auto-hide enabled." true
        fi
        ;;
        
    "$HOVER")
        if [ "$CURRENT_MODE" != "hover" ]; then
            stop_services
            systemctl --user start navbar-hover.service
            echo "hover" > "$MODE_FILE"
            makenotif customize preferences-system "Navbar" "Hover Mode enabled." true
        fi
        ;;
esac
